---
title: "Function fitting"
author: "Quentin D. Read"
date: "February 16, 2018"
output: pdf_document
---

# Modification history

* **9 Feb**: Original
* **16 Feb**: Edited version with respecified Weibull

# Scalings

For the forest light project, we have a lot of good visualizations of the pattern. Another important piece of the story, when it comes to inference about mechanism, is to fit appropriate functions to the data. In addition we need to get uncertainty around the predicted values generated by those fits. This is especially important because different theories have different predictions about what function will best fit the individual density, individual production, and total production scaling relationships. 

## Individual production

I fit the individual production scaling in two different ways:

1. **Power law**: Fit as a power law with positive exponent (straight increasing line on the log-log plot). This ignores the possible fall-off in production for small sizes due to small trees being outcompeted for light (2 parameters).

$$ p(x) = \beta_{0}x^{\beta_{1}} $$

2. **Power law times exponential**: Fit as a power law with positive exponent multiplied by an exponential function with negative exponent (5 parameters). If $b < 0$, the exponential term will lower the value of production for small values of diameter but then the term will go to zero as diameter increases, resulting in a power law at high values.

$$ p(x) = \beta_{0}x^{\beta_{1}}(ax^b + c) $$

Note that neither function could capture a decrease in production at large sizes relative to a power law.

## Density

I fit the density scaling in two different ways:

1. **Pareto**: Fit as a Pareto distribution (power law with negative exponent, so a straight decreasing line on the log-log plot). This cannot capture any fall-off in density at small sizes due to light starvation or at large sizes due to additional mortality of big trees.

$$ d(x) = \frac {\alpha x_{min}^{\alpha}} {x^{\alpha + 1}} $$

2. **Weibull**: Fit as a Weibull distribution which can capture those fall-offs. On 16 February, I updated the way the log density was calculated for the Weibull which gives a much better fit.

$$ d(x) = \frac {shape}{scale} (\frac {x}{scale})^{shape-1}e^{-{(\frac {x}{scale}})^{shape}} $$

## Total production

Following from the previous two, there are four possible combinations for total production (2 possible individual production fits by 2 possible density fits) since total production at a size class is just the individual production times the density at that size class.

\newpage
# Results

See figures below. All the fits are done for one year (1995), for all trees together and then for each of the five functional groups separately. A binned version of the raw data is shown, and the shaded areas around the fits are the 95% prediction intervals.

Summary (edited 16 Feb):

* The power law times exponential does capture the lower-than-expected production of small trees slightly better than the pure power law.
* The Weibull is a good fit to most of the production groups but group 4, where all trees die before a large size, is probably more of a Pareto distribution.
* For total production, the density functional form has a much greater impact than the production functional form on the fit.

With the new specification of Weibull, it does a much better job of fitting. We could also still try a piecewise function (Pareto or Weibull plus exponential at large sizes, like Caroline Farrior did) or a different distribution. 

\newpage
## Individual production figures

\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/alltree_1995_production.png}
\caption{All trees}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg1_1995_production.png}
\caption{Functional group 1}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg2_1995_production.png}
\caption{Functional group 2}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg3_1995_production.png}
\caption{Functional group 3}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg4_1995_production.png}
\caption{Functional group 4}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg5_1995_production.png}
\caption{Functional group 5}
\end{figure}

\newpage
## Density figures

\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/alltree_1995_density.png}
\caption{All trees}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg1_1995_density.png}
\caption{Functional group 1}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg2_1995_density.png}
\caption{Functional group 2}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg3_1995_density.png}
\caption{Functional group 3}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg4_1995_density.png}
\caption{Functional group 4}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg5_1995_density.png}
\caption{Functional group 5}
\end{figure}

\newpage
## Total production figures

\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/alltree_1995_totalproduction.png}
\caption{All trees}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg1_1995_totalproduction.png}
\caption{Functional group 1}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg2_1995_totalproduction.png}
\caption{Functional group 2}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg3_1995_totalproduction.png}
\caption{Functional group 3}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg4_1995_totalproduction.png}
\caption{Functional group 4}
\end{figure}

\newpage
\begin{figure}[h!]
\includegraphics[width=0.75\textwidth]{/Users/Q/google_drive/ForestLight/figs/credible_interval_plots/fg5_1995_totalproduction.png}
\caption{Functional group 5}
\end{figure}

